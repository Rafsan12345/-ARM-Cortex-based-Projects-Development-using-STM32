int main(void)
{
    HAL_Init();
    SystemClock_Config();
    MX_GPIO_Init();
    MX_TIM4_Init(); // Encoder mode

    HAL_TIM_Encoder_Start_IT(&htim4, TIM_CHANNEL_ALL);

    while(1)
    {
        // read encoder value in interrupt or periodically
    }
}

void HAL_TIM_IC_CaptureCallback(TIM_HandleTypeDef *htim)
{
    if(htim->Instance == TIM4)
    {
        uint32_t pos = __HAL_TIM_GET_COUNTER(htim);
    }
}
